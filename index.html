const QUESTIONS=[
  { q:"Stolica Polski?", a:["Warszawa","Kraków","Gdańsk","Wrocław"], correct:0 },
  { q:"Największy polski port morski?", a:["Gdańsk","Gdynia","Szczecin","Świnoujście"], correct:0 },
  { q:"Największe miasto na południu Polski?", a:["Kraków","Wrocław","Katowice","Łódź"], correct:0 },
  { q:"Polska jest członkiem NATO od?", a:["1999","2004","1990","2001"], correct:0 },
  { q:"Polski skoczek narciarski z medalami?", a:["Adam Małysz","Kamil Stoch","Piotr Żyła","Andrzej Stękała"], correct:1 },
  { q:"Największe miasto mazowieckiego?", a:["Warszawa","Radom","Płock","Siedlce"], correct:0 },
  { q:"Noblistka w dziedzinie chemii?", a:["Maria Skłodowska-Curie","Jan Czochralski","Michał Kalecki","Stefan Banach"], correct:0 },
  { q:"Najdłuższa rzeka w Polsce?", a:["Wisła","Odra","Warta","Bug"], correct:0 },
  { q:"Najwyższy szczyt w Polsce?", a:["Rysy","Śnieżka","Giewont","Babia Góra"], correct:0 },
  { q:"Rok odzyskania niepodległości?", a:["1918","1945","1914","1939"], correct:0 },
  { q:"Polski orzeł jest symbolem?", a:["Godła","Flagi","Hymnu","Herbu"], correct:0 },
  { q:"Największe miasto na Śląsku?", a:["Katowice","Gliwice","Częstochowa","Bytom"], correct:0 },
  { q:"Hymn Polski to?", a:["Mazurek Dąbrowskiego","Bogurodzica","Rota","Oda do radości"], correct:0 },
  { q:"Król „Lew Lechistanu”?", a:["Jan III Sobieski","Władysław Jagiełło","Zygmunt Stary","Bolesław Chrobry"], correct:0 }
];

let points=0, current=0, session=QUESTIONS.map((_,i)=>i).sort(()=>Math.random()-0.5);

function showQuestion() {
    // 1. PRZERWA REKLAMOWA W POŁOWIE (Pytanie 7)
    if (current === 7) {
        current++; 
        renderAdBreak("Przerwa reklamowa...");
        return;
    }

    // 2. PRZERWA REKLAMOWA PRZED WYNIKIEM
    if (current === session.length) {
        renderAdBreak("Przygotowanie wyniku...");
        setTimeout(finishQuiz, 5000);
        return;
    }

    const qIdx = session[current];
    const q = QUESTIONS[qIdx];
    
    $('question').textContent = q.q;
    $('answers').innerHTML = '';
    $('progress').textContent = `Pytanie ${current+1}/${session.length}`;

    // Mieszanie odpowiedzi
    q.a.map((ans,i)=>({ans,i})).sort(()=>Math.random()-0.5).forEach(obj=>{
        const b = document.createElement('div');
        b.className = 'btn'; 
        b.textContent = obj.ans;
        b.onclick = () => {
            // Blokada wielokrotnego klikania
            document.querySelectorAll('.btn').forEach(btn => btn.style.pointerEvents = 'none');

            if(obj.i === q.correct) {
                b.classList.add('good'); 
                points++; 
                firework();
                try { $('snd-ding').play(); } catch(e){}
            } else {
                b.classList.add('bad');
                try { $('snd-buzzer').play(); } catch(e){}
            }
            
            $('points').textContent = points;
            current++;
            setTimeout(showQuestion, 1200);
        };
        $('answers').appendChild(b);
    });
}

function renderAdBreak(msg) {
    $('answers').innerHTML = '<div style="grid-column:1/-1; text-align:center; color:var(--muted);">Reklama zasila nasz quiz...</div>';
    $('question').textContent = msg;
    
    // W 2026 skrypty typu Vignette/Interstitial potrzebują czasu na inicjację przy zmianie treści
    setTimeout(showQuestion, 5000);
}

function finishQuiz() {
    $('final-text').textContent = `${points} pkt`;
    $('final').style.display = 'flex';
    firework();
}

// --- SYSTEM FAJERWERKÓW ---
let fireworkRunning = false;
function firework(){ 
  if(fireworkRunning) return; 
  fireworkRunning = true; 
  const canvas=$('fx'), ctx=canvas.getContext('2d'); 
  canvas.width=window.innerWidth; 
  canvas.height=window.innerHeight; 
  const particles=[]; 
  const colors=['#ff3fc4','#00f0ff','#16d36a','#ffd27a','#ff5c6c','#ff8a00','#a020f0','#00ff90']; 
  const bursts=3+Math.floor(Math.random()*3); 
  
  for(let b=0;b<bursts;b++){ 
    const x=Math.random()*canvas.width, y=Math.random()*canvas.height*0.5; 
    for(let i=0;i<40;i++){ 
      particles.push({
        x,y,
        vx:(Math.random()-0.5)*10,
        vy:(Math.random()-0.5)*10,
        alpha:1,
        color:colors[Math.floor(Math.random()*colors.length)],
        size:2+Math.random()*2
      }); 
    } 
  } 
  
  function animate(){ 
    ctx.fillStyle='rgba(7,16,37,0.15)'; // Kolor tła dopasowany do v2026
    ctx.fillRect(0,0,canvas.width,canvas.height); 
    for(let i=particles.length-1; i>=0; i--){ 
      const p=particles[i]; 
      ctx.fillStyle=p.color; 
      ctx.globalAlpha=p.alpha; 
      ctx.beginPath(); 
      ctx.arc(p.x, p.y, p.size, 0, 2*Math.PI); 
      ctx.fill(); 
      p.x+=p.vx; p.y+=p.vy; p.vy+=0.1; p.alpha-=0.02; 
      if(p.alpha<=0) particles.splice(i,1); 
    } 
    if(particles.some(p=>p.alpha>0)) requestAnimationFrame(animate); 
    else { 
      ctx.clearRect(0,0,canvas.width,canvas.height); 
      fireworkRunning=false; 
    } 
  } 
  animate(); 
}

// Start aplikacji
showQuestion();
</script>
</body>
</html>
