// --- SILNIK FAJERWERKÓW 2026 ---
const canvas = document.getElementById('fx'), ctx = canvas.getContext('2d');
let particles = [];
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.onresize = resize; resize();

class Particle {
    constructor(x, y, color) {
        this.x = x; this.y = y; this.color = color;
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 8 + 2;
        this.v = { x: Math.cos(angle) * speed, y: Math.sin(angle) * speed };
        this.a = 1;
        this.gravity = 0.12;
        this.friction = 0.96;
    }
    draw() {
        ctx.save();
        ctx.globalAlpha = this.a;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.shadowBlur = 10;
        ctx.shadowColor = this.color;
        ctx.fill();
        ctx.restore();
    }
    update() {
        this.v.x *= this.friction;
        this.v.y *= this.friction;
        this.v.y += this.gravity;
        this.x += this.v.x;
        this.y += this.v.y;
        this.a -= 0.012;
    }
}

function explode() {
    const x = Math.random() * canvas.width;
    const y = Math.random() * (canvas.height * 0.4) + (canvas.height * 0.1);
    const hue = Math.random() * 360;
    const col = `hsl(${hue}, 100%, 60%)`;
    for(let i=0; i<80; i++) particles.push(new Particle(x, y, col));
}

function animate() {
    // To tworzy efekt smug (trails)
    ctx.fillStyle = 'rgba(7, 16, 37, 0.2)'; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    particles.forEach((p, i) => {
        if(p.a > 0){ p.update(); p.draw(); } 
        else { particles.splice(i, 1); }
    });
    requestAnimationFrame(animate);
}
animate();

// --- LOGIKA QUIZU ---
const QUESTIONS = [
    {q:"Stolica Polski?", a:["Kraków","Warszawa","Gdańsk","Poznań"], c:1},
    {q:"Najdłuższa rzeka w Polsce?", a:["Odra","Warta","Wisła","Bug"], c:2},
    {q:"W którym roku był Chrzest Polski?", a:["966","1000","1410","1918"], c:0},
    {q:"Najwyższy szczyt Polski?", a:["Giewont","Śnieżka","Rysy","Kasprowy Wierch"], c:2},
    {q:"Jakie miasto jest stolicą piernika?", a:["Toruń","Bydgoszcz","Lublin","Szczecin"], c:0},
    {q:"Ile województw ma Polska?", a:["12","14","16","18"], c:2},
    {q:"Który ptak jest w godle Polski?", a:["Bocian","Orzeł","Jastrząb","Sokół"], c:1},
    {q:"Największe jezioro w Polsce?", a:["Mamry","Hańcza","Śniardwy","Morskie Oko"], c:2},
    {q:"Z jakim państwem Polska ma najdłuższą granicę?", a:["Niemcy","Ukraina","Czechy","Słowacja"], c:2},
    {q:"Kto napisał 'Pan Tadeusz'?", a:["Juliusz Słowacki","Adam Mickiewicz","Bolesław Prus","Henryk Sienkiewicz"], c:1},
    {q:"Waluta obowiązująca w Polsce?", a:["Euro","Dolar","Złoty","Funt"], c:2},
    {q:"Kolory polskiej flagi to?", a:["Biało-Niebieskie","Czerwono-Białe","Biało-Czerwone","Żółto-Czerwone"], c:2},
    {q:"W którym roku Polska weszła do UE?", a:["1999","2004","2010","1989"], c:1},
    {q:"Gdzie znajduje się Wawel?", a:["W Warszawie","W Krakowie","W Poznaniu","W Gnieźnie"], c:1}
];

let cur = 0, pts = 0, musicStarted = false;
const ding = document.getElementById("snd-ding"), buzzer = document.getElementById("snd-buzzer"), 
      fanfare = document.getElementById("snd-fanfare"), bgMusic = document.getElementById("bg-music");

function render() {
    if(cur === 7) { showAdScreen('mid'); return; }
    if(cur === 14) { showAdScreen('final'); return; }

    document.getElementById("bar").style.width = (cur/14*100) + "%";
    document.getElementById("q-num").innerText = `Pytanie ${cur+1}/14`;
    document.getElementById("q-text").innerText = QUESTIONS[cur].q;
    
    const box = document.getElementById("ans-box");
    box.innerHTML = "";
    QUESTIONS[cur].a.forEach((txt, i) => {
        const b = document.createElement("button");
        b.className = "btn";
        b.innerText = txt;
        b.onclick = () => {
            if(!musicStarted) { bgMusic.volume=0.3; bgMusic.play(); musicStarted=true; }
            if(i === QUESTIONS[cur].c) { 
                pts++; 
                try { ding.currentTime=0; ding.play(); } catch(e){}
                explode(); // Epicki wystrzał
            } else { 
                try { buzzer.currentTime=0; buzzer.play(); } catch(e){} 
            }
            cur++; render();
        };
        box.appendChild(b);
    });
}

function showAdScreen(type) {
    document.getElementById("quizBox").style.display = "none";
    bgMusic.pause();
    const screenId = type === 'mid' ? "ad-mid-screen" : "ad-final-screen";
    const containerId = type === 'mid' ? "ad-mid-container" : "ad-final-container";
    const zoneId = type === 'mid' ? "10306652" : "10306653";
    
    document.getElementById(screenId).classList.remove("hidden");
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    const s = document.createElement("script");
    s.src = `a.monetag.com{zoneId}.js`;
    s.async = true;
    container.appendChild(s);
}

function resumeAfterAd(type) {
    document.getElementById(type === 'mid' ? "ad-mid-screen" : "ad-final-screen").classList.add("hidden");
    document.getElementById("quizBox").style.display = "block";
    bgMusic.play();
    if(type === 'mid') { cur++; render(); } 
    else { showResults(); }
}

function showResults() {
    document.getElementById("quizBox").style.display = "none";
    document.getElementById("result-screen").classList.remove("hidden");
    document.getElementById("score-text").innerText = `${pts}/14`;
    fanfare.play();
    // Wielki finał fajerwerków
    for(let i=0; i<15; i++) setTimeout(explode, i*300);
}

render();
